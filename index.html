<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teorema de Bayes - Aplicaciones Interactivas</title>
    
    <!-- MathJax para renderizar LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --bg-color: #ecf0f1;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --border-color: #bdc3c7;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 30px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            padding: 30px 20px;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            background: var(--card-bg);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: var(--primary-color);
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .tab-button.active {
            background: var(--secondary-color);
            color: white;
        }

        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.8em;
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .card {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        input[type="number"],
        input[type="text"],
        select {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            width: 100%;
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        button {
            padding: 12px 30px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        button:active {
            transform: translateY(0);
        }

        .result-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid var(--secondary-color);
        }

        .formula-box {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--warning-color);
        }

        .example-box {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--success-color);
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--secondary-color);
        }

        .warning-box {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--warning-color);
        }

        .stat-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-item .value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .probability-bar {
            width: 100%;
            height: 30px;
            background: var(--bg-color);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--secondary-color));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .tree-diagram {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        .tree-node {
            display: inline-block;
            padding: 10px 20px;
            background: var(--secondary-color);
            color: white;
            border-radius: 8px;
            margin: 5px;
            font-weight: bold;
        }

        .tree-branch {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: var(--bg-color);
        }

        .highlight {
            background: #fff9c4;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        ul, ol {
            margin-left: 30px;
            margin-top: 10px;
        }

        li {
            margin-bottom: 10px;
        }

        h3 {
            color: var(--primary-color);
            margin-top: 20px;
            margin-bottom: 10px;
        }

        h4 {
            color: var(--secondary-color);
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .button-secondary {
            background: var(--success-color);
        }

        .button-secondary:hover {
            background: #229954;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé≤ Teorema de Bayes y Aplicaciones de Probabilidad</h1>
            <p>Herramienta interactiva para entender y aplicar el Teorema de Bayes</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab('teoria')">üìö Teor√≠a</button>
            <button class="tab-button" onclick="openTab('calculadora')">üßÆ Calculadora</button>
            <button class="tab-button" onclick="openTab('medica')">üè• Aplicaci√≥n M√©dica</button>
            <button class="tab-button" onclick="openTab('spam')">üìß Filtro de Spam</button>
            <button class="tab-button" onclick="openTab('ejemplos')">üí° Ejemplos Pr√°cticos</button>
            <button class="tab-button" onclick="openTab('visualizacion')">üìä Visualizaci√≥n</button>
        </div>

        <!-- TAB 1: TEOR√çA -->
        <div id="teoria" class="tab-content active">
            <h2 class="section-title">Teorema de Bayes - Fundamentos Te√≥ricos</h2>
            
            <div class="formula-box">
                <h3>üéØ F√≥rmula del Teorema de Bayes</h3>
                <p style="text-align: center; font-size: 1.2em; margin: 20px 0;">
                    $$P(A|B) = \frac{P(B|A) \cdot P(A)}{P(B)}$$
                </p>
                <p>O en su forma expandida:</p>
                <p style="text-align: center; font-size: 1.2em; margin: 20px 0;">
                    $$P(A|B) = \frac{P(B|A) \cdot P(A)}{P(B|A) \cdot P(A) + P(B|A^c) \cdot P(A^c)}$$
                </p>
            </div>

            <div class="info-box">
                <h3>üìñ Interpretaci√≥n de los t√©rminos</h3>
                <ul>
                    <li><strong>\(P(A|B)\)</strong> - <span class="highlight">Probabilidad a posteriori</span>: Probabilidad de A dado que B ha ocurrido</li>
                    <li><strong>\(P(B|A)\)</strong> - <span class="highlight">Verosimilitud</span>: Probabilidad de observar B si A es verdadero</li>
                    <li><strong>\(P(A)\)</strong> - <span class="highlight">Probabilidad a priori</span>: Probabilidad inicial de A antes de observar B</li>
                    <li><strong>\(P(B)\)</strong> - <span class="highlight">Evidencia</span>: Probabilidad total de observar B</li>
                </ul>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>üîë Conceptos Clave</h3>
                    <h4>1. Probabilidad Condicional</h4>
                    <p>La probabilidad de que ocurra un evento A dado que ya ocurri√≥ B:</p>
                    <p style="text-align: center;">$$P(A|B) = \frac{P(A \cap B)}{P(B)}$$</p>
                    
                    <h4>2. Regla de la Probabilidad Total</h4>
                    <p>Para particionar el espacio muestral:</p>
                    <p style="text-align: center;">$$P(B) = \sum_{i} P(B|A_i) \cdot P(A_i)$$</p>
                    
                    <h4>3. Actualizaci√≥n Bayesiana</h4>
                    <p>El teorema permite <strong>actualizar nuestras creencias</strong> a medida que obtenemos nueva informaci√≥n.</p>
                </div>

                <div class="card">
                    <h3>üé® Ejemplo Intuitivo</h3>
                    <div class="example-box">
                        <h4>El problema de las urnas</h4>
                        <p><strong>Situaci√≥n:</strong> Tenemos dos urnas:</p>
                        <ul>
                            <li>Urna 1: 70% bolas rojas, 30% azules</li>
                            <li>Urna 2: 30% bolas rojas, 70% azules</li>
                        </ul>
                        <p><strong>Pregunta:</strong> Elegimos una urna al azar y sacamos una bola roja. ¬øCu√°l es la probabilidad de que sea de la Urna 1?</p>
                        
                        <p><strong>Soluci√≥n:</strong></p>
                        <ul>
                            <li>\(P(U_1) = 0.5\) (a priori)</li>
                            <li>\(P(R|U_1) = 0.7\) (verosimilitud)</li>
                            <li>\(P(R|U_2) = 0.3\)</li>
                        </ul>
                        <p style="text-align: center;">
                            $$P(U_1|R) = \frac{0.7 \times 0.5}{0.7 \times 0.5 + 0.3 \times 0.5} = \frac{0.35}{0.5} = 0.7$$
                        </p>
                        <p><strong>Conclusi√≥n:</strong> Hay un 70% de probabilidad de que la bola provenga de la Urna 1.</p>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <h3>‚ö†Ô∏è Errores Comunes</h3>
                <ol>
                    <li><strong>Confundir \(P(A|B)\) con \(P(B|A)\)</strong> - Son generalmente diferentes (falacia del fiscal)</li>
                    <li><strong>Ignorar la probabilidad a priori</strong> - \(P(A)\) es crucial para el resultado final</li>
                    <li><strong>No considerar todas las alternativas</strong> - Olvidar \(P(B|A^c)\) en el denominador</li>
                    <li><strong>Usar proporciones inadecuadas</strong> - Verificar que todas las probabilidades sumen 1</li>
                </ol>
            </div>

            <h3>üìê Forma General (M√∫ltiples Hip√≥tesis)</h3>
            <div class="formula-box">
                <p>Cuando tenemos n hip√≥tesis mutuamente excluyentes \(H_1, H_2, ..., H_n\):</p>
                <p style="text-align: center; font-size: 1.1em; margin: 20px 0;">
                    $$P(H_i|E) = \frac{P(E|H_i) \cdot P(H_i)}{\sum_{j=1}^{n} P(E|H_j) \cdot P(H_j)}$$
                </p>
                <p>Donde \(E\) es la evidencia observada y \(H_i\) es la hip√≥tesis i.</p>
            </div>
        </div>

        <!-- TAB 2: CALCULADORA -->
        <div id="calculadora" class="tab-content">
            <h2 class="section-title">üßÆ Calculadora del Teorema de Bayes</h2>
            
            <div class="grid-2">
                <div class="card">
                    <h3>Ingrese las Probabilidades</h3>
                    
                    <div class="input-group">
                        <label for="prior">Probabilidad a priori P(A):</label>
                        <input type="number" id="prior" min="0" max="1" step="0.01" value="0.01" placeholder="0.01">
                        <small>Probabilidad inicial del evento A (entre 0 y 1)</small>
                    </div>

                    <div class="input-group">
                        <label for="likelihood">Verosimilitud P(B|A):</label>
                        <input type="number" id="likelihood" min="0" max="1" step="0.01" value="0.95" placeholder="0.95">
                        <small>Probabilidad de B dado que A es verdadero</small>
                    </div>

                    <div class="input-group">
                        <label for="falsePositive">Falso positivo P(B|A<sup>c</sup>):</label>
                        <input type="number" id="falsePositive" min="0" max="1" step="0.01" value="0.05" placeholder="0.05">
                        <small>Probabilidad de B dado que A es falso</small>
                    </div>

                    <div class="button-group">
                        <button onclick="calcularBayes()">Calcular</button>
                        <button class="button-secondary" onclick="cargarEjemploCalc(1)">Ejemplo 1</button>
                        <button class="button-secondary" onclick="cargarEjemploCalc(2)">Ejemplo 2</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Visualizaci√≥n de Probabilidades</h3>
                    <div id="probVisualizacion">
                        <p style="text-align: center; color: #999; padding: 40px;">
                            Ingrese los valores y presione "Calcular"
                        </p>
                    </div>
                </div>
            </div>

            <div id="resultadosBayes"></div>
        </div>

        <!-- TAB 3: APLICACI√ìN M√âDICA -->
        <div id="medica" class="tab-content">
            <h2 class="section-title">üè• Aplicaci√≥n M√©dica - Pruebas Diagn√≥sticas</h2>
            
            <div class="info-box">
                <h3>üìã Contexto</h3>
                <p>El teorema de Bayes es fundamental en medicina para interpretar resultados de pruebas diagn√≥sticas. 
                Permite calcular la probabilidad real de tener una enfermedad dado un resultado positivo, considerando 
                la prevalencia de la enfermedad y las caracter√≠sticas de la prueba.</p>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>Par√°metros de la Prueba</h3>
                    
                    <div class="input-group">
                        <label for="prevalencia">Prevalencia de la enfermedad (%):</label>
                        <input type="number" id="prevalencia" min="0" max="100" step="0.1" value="1" placeholder="1">
                        <small>Porcentaje de la poblaci√≥n que tiene la enfermedad</small>
                    </div>

                    <div class="input-group">
                        <label for="sensibilidad">Sensibilidad de la prueba (%):</label>
                        <input type="number" id="sensibilidad" min="0" max="100" step="0.1" value="95" placeholder="95">
                        <small>Probabilidad de resultado positivo si tiene la enfermedad</small>
                    </div>

                    <div class="input-group">
                        <label for="especificidad">Especificidad de la prueba (%):</label>
                        <input type="number" id="especificidad" min="0" max="100" step="0.1" value="95" placeholder="95">
                        <small>Probabilidad de resultado negativo si NO tiene la enfermedad</small>
                    </div>

                    <div class="button-group">
                        <button onclick="calcularDiagnostico()">Calcular VPP y VPN</button>
                        <button class="button-secondary" onclick="cargarEjemploMedico(1)">COVID-19</button>
                        <button class="button-secondary" onclick="cargarEjemploMedico(2)">Enfermedad Rara</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Interpretaci√≥n</h3>
                    <div class="formula-box">
                        <h4>Valor Predictivo Positivo (VPP)</h4>
                        <p>Probabilidad de tener la enfermedad dado un resultado positivo:</p>
                        <p style="text-align: center;">
                            $$VPP = P(E^+|T^+) = \frac{Sensibilidad \times Prevalencia}{Sensibilidad \times Prevalencia + (1-Especificidad) \times (1-Prevalencia)}$$
                        </p>
                        
                        <h4 style="margin-top: 20px;">Valor Predictivo Negativo (VPN)</h4>
                        <p>Probabilidad de NO tener la enfermedad dado un resultado negativo:</p>
                        <p style="text-align: center;">
                            $$VPN = P(E^-|T^-) = \frac{Especificidad \times (1-Prevalencia)}{(1-Sensibilidad) \times Prevalencia + Especificidad \times (1-Prevalencia)}$$
                        </p>
                    </div>
                </div>
            </div>

            <div id="resultadosMedico"></div>

            <div class="chart-container" style="height: 300px;">
                <canvas id="chartMedico"></canvas>
            </div>
        </div>

        <!-- TAB 4: FILTRO DE SPAM -->
        <div id="spam" class="tab-content">
            <h2 class="section-title">üìß Clasificaci√≥n Bayesiana - Filtro de Spam</h2>
            
            <div class="info-box">
                <h3>ü§ñ Clasificador Naive Bayes</h3>
                <p>Los filtros de spam modernos utilizan el teorema de Bayes para clasificar emails. 
                El algoritmo calcula la probabilidad de que un email sea spam bas√°ndose en la presencia 
                de ciertas palabras clave.</p>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>Configuraci√≥n del Filtro</h3>
                    
                    <div class="input-group">
                        <label for="probSpam">Probabilidad a priori de Spam (%):</label>
                        <input type="number" id="probSpam" min="0" max="100" step="1" value="30" placeholder="30">
                        <small>Porcentaje de emails que son spam en general</small>
                    </div>

                    <h4 style="margin-top: 20px;">Palabras clave detectadas:</h4>
                    
                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="word1" checked> "Gratis" / "Free"
                            <small style="display: block; margin-left: 25px;">P(palabra|spam) = 80%, P(palabra|no spam) = 10%</small>
                        </label>
                    </div>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="word2" checked> "Dinero" / "Money"
                            <small style="display: block; margin-left: 25px;">P(palabra|spam) = 70%, P(palabra|no spam) = 5%</small>
                        </label>
                    </div>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="word3"> "Urgente" / "Urgent"
                            <small style="display: block; margin-left: 25px;">P(palabra|spam) = 60%, P(palabra|no spam) = 15%</small>
                        </label>
                    </div>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="word4"> "Click aqu√≠" / "Click here"
                            <small style="display: block; margin-left: 25px;">P(palabra|spam) = 75%, P(palabra|no spam) = 8%</small>
                        </label>
                    </div>

                    <button onclick="clasificarSpam()">Clasificar Email</button>
                </div>

                <div class="card">
                    <h3>Explicaci√≥n del Algoritmo</h3>
                    <div class="formula-box">
                        <h4>Clasificador Naive Bayes</h4>
                        <p>Para cada palabra \(w_i\) presente en el email:</p>
                        <p style="text-align: center;">
                            $$P(Spam|w_1, w_2, ..., w_n) = \frac{P(w_1, w_2, ..., w_n|Spam) \cdot P(Spam)}{P(w_1, w_2, ..., w_n)}$$
                        </p>
                        <p><strong>Supuesto "Naive":</strong> Las palabras son independientes entre s√≠</p>
                        <p style="text-align: center;">
                            $$P(w_1, w_2, ..., w_n|Spam) = \prod_{i=1}^{n} P(w_i|Spam)$$
                        </p>
                    </div>

                    <div class="warning-box">
                        <h4>‚ö†Ô∏è Nota Importante</h4>
                        <p>El supuesto de independencia ("naive") es una simplificaci√≥n que hace el c√°lculo 
                        m√°s eficiente, aunque en la pr√°ctica las palabras pueden estar correlacionadas. 
                        A pesar de esto, el algoritmo funciona sorprendentemente bien.</p>
                    </div>
                </div>
            </div>

            <div id="resultadosSpam"></div>
        </div>

        <!-- TAB 5: EJEMPLOS PR√ÅCTICOS -->
        <div id="ejemplos" class="tab-content">
            <h2 class="section-title">üí° Ejemplos Pr√°cticos Resueltos</h2>
            
            <div class="example-box">
                <h3>Ejemplo 1: El Problema del Taxi</h3>
                <p><strong>Planteamiento:</strong></p>
                <p>En una ciudad, el 85% de los taxis son azules y el 15% son verdes. Un taxi atropella a 
                un peat√≥n y se da a la fuga. Un testigo identifica el taxi como verde. Sin embargo, se sabe 
                que bajo condiciones similares de visibilidad, los testigos identifican correctamente el color 
                el 80% del tiempo.</p>
                
                <p><strong>¬øCu√°l es la probabilidad de que el taxi realmente fuera verde?</strong></p>
                
                <button onclick="mostrarSolucion(1)" style="margin: 15px 0;">Ver Soluci√≥n</button>
                
                <div id="solucion1" style="display: none;">
                    <h4>Soluci√≥n:</h4>
                    <p><strong>Datos:</strong></p>
                    <ul>
                        <li>\(P(Verde) = 0.15\) (probabilidad a priori)</li>
                        <li>\(P(Azul) = 0.85\)</li>
                        <li>\(P(Testigo\ dice\ Verde|Verde) = 0.80\) (sensibilidad)</li>
                        <li>\(P(Testigo\ dice\ Verde|Azul) = 0.20\) (falso positivo)</li>
                    </ul>
                    
                    <p><strong>Aplicando Bayes:</strong></p>
                    <p style="text-align: center;">
                        $$P(Verde|Testigo\ dice\ Verde) = \frac{P(Testigo|Verde) \cdot P(Verde)}{P(Testigo|Verde) \cdot P(Verde) + P(Testigo|Azul) \cdot P(Azul)}$$
                    </p>
                    <p style="text-align: center;">
                        $$= \frac{0.80 \times 0.15}{0.80 \times 0.15 + 0.20 \times 0.85} = \frac{0.12}{0.12 + 0.17} = \frac{0.12}{0.29} \approx 0.414$$
                    </p>
                    
                    <p><strong>Respuesta:</strong> A pesar del testimonio, solo hay un 41.4% de probabilidad de que 
                    el taxi fuera realmente verde. La alta prevalencia de taxis azules (85%) reduce significativamente 
                    la probabilidad posterior.</p>
                    
                    <div class="info-box" style="margin-top: 15px;">
                        <p><strong>Lecci√≥n clave:</strong> La probabilidad a priori (prevalencia) tiene un impacto 
                        enorme en el resultado final, incluso cuando tenemos evidencia aparentemente fuerte.</p>
                    </div>
                </div>
            </div>

            <div class="example-box">
                <h3>Ejemplo 2: Detecci√≥n de Fraude</h3>
                <p><strong>Planteamiento:</strong></p>
                <p>Una empresa de tarjetas de cr√©dito quiere detectar transacciones fraudulentas. Se sabe que:</p>
                <ul>
                    <li>El 0.1% de todas las transacciones son fraudulentas</li>
                    <li>El sistema de detecci√≥n identifica correctamente el 99% de las transacciones fraudulentas</li>
                    <li>El sistema marca como sospechosas el 2% de las transacciones leg√≠timas (falsos positivos)</li>
                </ul>
                
                <p><strong>Si el sistema marca una transacci√≥n como sospechosa, ¬øcu√°l es la probabilidad de que sea realmente fraudulenta?</strong></p>
                
                <button onclick="mostrarSolucion(2)" style="margin: 15px 0;">Ver Soluci√≥n</button>
                
                <div id="solucion2" style="display: none;">
                    <h4>Soluci√≥n:</h4>
                    <p><strong>Datos:</strong></p>
                    <ul>
                        <li>\(P(Fraude) = 0.001\)</li>
                        <li>\(P(Alerta|Fraude) = 0.99\)</li>
                        <li>\(P(Alerta|No\ Fraude) = 0.02\)</li>
                    </ul>
                    
                    <p><strong>Aplicando Bayes:</strong></p>
                    <p style="text-align: center;">
                        $$P(Fraude|Alerta) = \frac{0.99 \times 0.001}{0.99 \times 0.001 + 0.02 \times 0.999}$$
                    </p>
                    <p style="text-align: center;">
                        $$= \frac{0.00099}{0.00099 + 0.01998} = \frac{0.00099}{0.02097} \approx 0.047$$
                    </p>
                    
                    <p><strong>Respuesta:</strong> Solo el 4.7% de las transacciones marcadas son realmente fraudulentas.</p>
                    
                    <div class="warning-box" style="margin-top: 15px;">
                        <p><strong>Implicaci√≥n pr√°ctica:</strong> Aunque el sistema tiene una precisi√≥n del 99%, 
                        la baja prevalencia de fraudes (0.1%) significa que la mayor√≠a de las alertas son falsos 
                        positivos. Por cada transacci√≥n fraudulenta detectada, habr√° aproximadamente 20 alertas falsas.</p>
                    </div>
                    
                    <h4>Tabla de Confusi√≥n (por cada 100,000 transacciones):</h4>
                    <table>
                        <thead>
                            <tr>
                                <th></th>
                                <th>Realmente Fraude</th>
                                <th>Realmente Leg√≠tima</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Alerta positiva</strong></td>
                                <td style="background: #ffebee;">99</td>
                                <td style="background: #fff3e0;">1,998</td>
                                <td><strong>2,097</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Alerta negativa</strong></td>
                                <td>1</td>
                                <td>97,902</td>
                                <td>97,903</td>
                            </tr>
                            <tr>
                                <td><strong>Total</strong></td>
                                <td><strong>100</strong></td>
                                <td><strong>99,900</strong></td>
                                <td><strong>100,000</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="example-box">
                <h3>Ejemplo 3: Prueba de Dopaje</h3>
                <p><strong>Planteamiento:</strong></p>
                <p>Un atleta da positivo en una prueba de dopaje. La prueba tiene las siguientes caracter√≠sticas:</p>
                <ul>
                    <li>Sensibilidad: 95% (detecta el 95% de los que usan dopaje)</li>
                    <li>Especificidad: 90% (da negativo en el 90% de los que no usan dopaje)</li>
                    <li>Se estima que el 2% de los atletas usan dopaje</li>
                </ul>
                
                <p><strong>¬øCu√°l es la probabilidad de que el atleta realmente haya usado dopaje?</strong></p>
                
                <button onclick="mostrarSolucion(3)" style="margin: 15px 0;">Ver Soluci√≥n</button>
                
                <div id="solucion3" style="display: none;">
                    <h4>Soluci√≥n:</h4>
                    <p><strong>Datos:</strong></p>
                    <ul>
                        <li>\(P(Dopaje) = 0.02\)</li>
                        <li>\(P(Positivo|Dopaje) = 0.95\)</li>
                        <li>\(P(Positivo|No\ Dopaje) = 1 - 0.90 = 0.10\)</li>
                    </ul>
                    
                    <p><strong>Aplicando Bayes:</strong></p>
                    <p style="text-align: center;">
                        $$P(Dopaje|Positivo) = \frac{0.95 \times 0.02}{0.95 \times 0.02 + 0.10 \times 0.98}$$
                    </p>
                    <p style="text-align: center;">
                        $$= \frac{0.019}{0.019 + 0.098} = \frac{0.019}{0.117} \approx 0.162$$
                    </p>
                    
                    <p><strong>Respuesta:</strong> Hay aproximadamente un 16.2% de probabilidad de que el atleta 
                    realmente haya usado dopaje.</p>
                    
                    <div class="warning-box" style="margin-top: 15px;">
                        <p><strong>Importancia:</strong> Este resultado muestra por qu√© muchas organizaciones deportivas 
                        requieren una segunda prueba confirmatoria antes de sancionar a un atleta. Un √∫nico resultado 
                        positivo, dado la baja prevalencia, tiene una probabilidad significativa de ser un falso positivo.</p>
                    </div>

                    <h4>An√°lisis visual:</h4>
                    <div class="stat-display">
                        <div class="stat-item">
                            <div class="label">Verdaderos Positivos</div>
                            <div class="value" style="color: #27ae60;">16.2%</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">Falsos Positivos</div>
                            <div class="value" style="color: #e74c3c;">83.8%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 6: VISUALIZACI√ìN -->
        <div id="visualizacion" class="tab-content">
            <h2 class="section-title">üìä Visualizaci√≥n Interactiva</h2>
            
            <div class="info-box">
                <h3>üéØ Explore c√≥mo var√≠an las probabilidades</h3>
                <p>Use los controles deslizantes para ver c√≥mo cambia la probabilidad a posteriori 
                en funci√≥n de diferentes par√°metros.</p>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3>Controles de Par√°metros</h3>
                    
                    <div class="input-group">
                        <label for="priorSlider">
                            Probabilidad a priori P(A): <span id="priorValue">0.10</span>
                        </label>
                        <input type="range" id="priorSlider" min="0.01" max="0.99" step="0.01" value="0.10" 
                               style="width: 100%;" oninput="actualizarVisualizacion()">
                    </div>

                    <div class="input-group">
                        <label for="likelihoodSlider">
                            Verosimilitud P(B|A): <span id="likelihoodValue">0.90</span>
                        </label>
                        <input type="range" id="likelihoodSlider" min="0.01" max="0.99" step="0.01" value="0.90" 
                               style="width: 100%;" oninput="actualizarVisualizacion()">
                    </div>

                    <div class="input-group">
                        <label for="falseposSlider">
                            Falso positivo P(B|A<sup>c</sup>): <span id="falseposValue">0.10</span>
                        </label>
                        <input type="range" id="falseposSlider" min="0.01" max="0.99" step="0.01" value="0.10" 
                               style="width: 100%;" oninput="actualizarVisualizacion()">
                    </div>

                    <div class="result-box">
                        <h4>Probabilidad a Posteriori</h4>
                        <div class="probability-bar">
                            <div class="probability-fill" id="posteriorBar" style="width: 50%;">
                                <span id="posteriorText">50%</span>
                            </div>
                        </div>
                        <p style="text-align: center; margin-top: 10px;">
                            <strong>P(A|B) = <span id="posteriorValue">0.5000</span></strong>
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h3>Gr√°fico Interactivo</h3>
                    <div class="chart-container" style="height: 350px;">
                        <canvas id="chartVisualizacion"></canvas>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>An√°lisis de Sensibilidad</h3>
                <p>El siguiente gr√°fico muestra c√≥mo var√≠a P(A|B) al cambiar la probabilidad a priori:</p>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="chartSensibilidad"></canvas>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ============================================
        // FUNCIONES GENERALES
        // ============================================
        
        function openTab(tabName) {
            const contents = document.getElementsByClassName('tab-content');
            for (let content of contents) {
                content.classList.remove('active');
            }
            
            const buttons = document.getElementsByClassName('tab-button');
            for (let button of buttons) {
                button.classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }

        // ============================================
        // TAB 2: CALCULADORA
        // ============================================
        
        function calcularBayes() {
            const prior = parseFloat(document.getElementById('prior').value);
            const likelihood = parseFloat(document.getElementById('likelihood').value);
            const falsePositive = parseFloat(document.getElementById('falsePositive').value);
            
            if (prior < 0 || prior > 1 || likelihood < 0 || likelihood > 1 || falsePositive < 0 || falsePositive > 1) {
                alert('Todas las probabilidades deben estar entre 0 y 1');
                return;
            }
            
            // Calcular P(B)
            const pB = likelihood * prior + falsePositive * (1 - prior);
            
            // Calcular P(A|B) - Probabilidad a posteriori
            const posterior = (likelihood * prior) / pB;
            
            // Calcular P(A^c|B) - Probabilidad de falso positivo
            const falsePosterior = (falsePositive * (1 - prior)) / pB;
            
            // Visualizaci√≥n
            let vizHtml = '<div class="stat-display">';
            vizHtml += `<div class="stat-item"><div class="label">P(A)</div><div class="value">${prior.toFixed(4)}</div></div>`;
            vizHtml += `<div class="stat-item"><div class="label">P(B|A)</div><div class="value">${likelihood.toFixed(4)}</div></div>`;
            vizHtml += `<div class="stat-item"><div class="label">P(B|A<sup>c</sup>)</div><div class="value">${falsePositive.toFixed(4)}</div></div>`;
            vizHtml += `<div class="stat-item"><div class="label">P(B)</div><div class="value">${pB.toFixed(4)}</div></div>`;
            vizHtml += '</div>';
            
            vizHtml += '<div style="margin-top: 20px;">';
            vizHtml += '<h4>Probabilidad a Posteriori P(A|B):</h4>';
            vizHtml += '<div class="probability-bar">';
            vizHtml += `<div class="probability-fill" style="width: ${posterior * 100}%">${(posterior * 100).toFixed(2)}%</div>`;
            vizHtml += '</div>';
            
            vizHtml += '<h4 style="margin-top: 20px;">Probabilidad de Falso Positivo P(A<sup>c</sup>|B):</h4>';
            vizHtml += '<div class="probability-bar">';
            vizHtml += `<div class="probability-fill" style="width: ${falsePosterior * 100}%; background: linear-gradient(90deg, #e74c3c, #c0392b);">${(falsePosterior * 100).toFixed(2)}%</div>`;
            vizHtml += '</div>';
            vizHtml += '</div>';
            
            document.getElementById('probVisualizacion').innerHTML = vizHtml;
            
            // Resultados detallados
            let html = '<div class="result-box">';
            html += '<h3>Resultados del C√°lculo</h3>';
            
            html += '<div class="formula-box">';
            html += '<h4>Paso 1: Calcular P(B) usando la ley de probabilidad total</h4>';
            html += `<p style="text-align: center;">$$P(B) = P(B|A) \\cdot P(A) + P(B|A^c) \\cdot P(A^c)$$</p>`;
            html += `<p style="text-align: center;">$$P(B) = ${likelihood} \\times ${prior} + ${falsePositive} \\times ${(1-prior).toFixed(4)}$$</p>`;
            html += `<p style="text-align: center;">$$P(B) = ${pB.toFixed(6)}$$</p>`;
            html += '</div>';
            
            html += '<div class="formula-box">';
            html += '<h4>Paso 2: Aplicar el Teorema de Bayes</h4>';
            html += `<p style="text-align: center;">$$P(A|B) = \\frac{P(B|A) \\cdot P(A)}{P(B)}$$</p>`;
            html += `<p style="text-align: center;">$$P(A|B) = \\frac{${likelihood} \\times ${prior}}{${pB.toFixed(6)}}$$</p>`;
            html += `<p style="text-align: center; font-size: 1.3em; color: #27ae60;"><strong>$$P(A|B) = ${posterior.toFixed(6)}$$</strong></p>`;
            html += '</div>';
            
            html += '<div class="info-box">';
            html += '<h4>üìä Interpretaci√≥n</h4>';
            html += `<p>Dada la evidencia B, la probabilidad de que A sea verdadero es <strong>${(posterior * 100).toFixed(2)}%</strong>.</p>`;
            html += `<p>La probabilidad a priori era ${(prior * 100).toFixed(2)}%, `;
            if (posterior > prior) {
                html += `y ha <strong style="color: #27ae60;">aumentado</strong> a ${(posterior * 100).toFixed(2)}% despu√©s de observar B.`;
            } else {
                html += `y ha <strong style="color: #e74c3c;">disminuido</strong> a ${(posterior * 100).toFixed(2)}% despu√©s de observar B.`;
            }
            html += '</p>';
            
            const oddsRatio = (posterior / (1 - posterior)) / (prior / (1 - prior));
            html += `<p><strong>Factor de Bayes:</strong> ${oddsRatio.toFixed(4)} - `;
            if (oddsRatio > 1) {
                html += 'La evidencia apoya la hip√≥tesis A.';
            } else {
                html += 'La evidencia contradice la hip√≥tesis A.';
            }
            html += '</p>';
            html += '</div>';
            
            html += '</div>';
            
            document.getElementById('resultadosBayes').innerHTML = html;
            if (window.MathJax) MathJax.typesetPromise();
        }

        function cargarEjemploCalc(num) {
            if (num === 1) {
                // Ejemplo: Prueba m√©dica
                document.getElementById('prior').value = 0.01;
                document.getElementById('likelihood').value = 0.95;
                document.getElementById('falsePositive').value = 0.05;
            } else if (num === 2) {
                // Ejemplo: Detector de fraude
                document.getElementById('prior').value = 0.001;
                document.getElementById('likelihood').value = 0.99;
                document.getElementById('falsePositive').value = 0.02;
            }
        }

        // ============================================
        // TAB 3: APLICACI√ìN M√âDICA
        // ============================================
        
        let chartMedico = null;

        function calcularDiagnostico() {
            const prevalencia = parseFloat(document.getElementById('prevalencia').value) / 100;
            const sensibilidad = parseFloat(document.getElementById('sensibilidad').value) / 100;
            const especificidad = parseFloat(document.getElementById('especificidad').value) / 100;
            
            // Calcular VPP (Valor Predictivo Positivo)
            const vpp = (sensibilidad * prevalencia) / 
                        (sensibilidad * prevalencia + (1 - especificidad) * (1 - prevalencia));
            
            // Calcular VPN (Valor Predictivo Negativo)
            const vpn = (especificidad * (1 - prevalencia)) / 
                        ((1 - sensibilidad) * prevalencia + especificidad * (1 - prevalencia));
            
            // Tasa de falsos positivos y falsos negativos
            const tasaFP = (1 - especificidad) * (1 - prevalencia);
            const tasaFN = (1 - sensibilidad) * prevalencia;
            
            let html = '<div class="result-box">';
            html += '<h3>Resultados de la Prueba Diagn√≥stica</h3>';
            
            html += '<div class="stat-display">';
            html += `<div class="stat-item"><div class="label">Prevalencia</div><div class="value">${(prevalencia * 100).toFixed(2)}%</div></div>`;
            html += `<div class="stat-item"><div class="label">Sensibilidad</div><div class="value">${(sensibilidad * 100).toFixed(2)}%</div></div>`;
            html += `<div class="stat-item"><div class="label">Especificidad</div><div class="value">${(especificidad * 100).toFixed(2)}%</div></div>`;
            html += '</div>';
            
            html += '<div class="stat-display" style="margin-top: 20px;">';
            html += `<div class="stat-item" style="background: #e8f5e9;"><div class="label">VPP (Valor Predictivo Positivo)</div><div class="value" style="color: #27ae60;">${(vpp * 100).toFixed(2)}%</div></div>`;
            html += `<div class="stat-item" style="background: #e3f2fd;"><div class="label">VPN (Valor Predictivo Negativo)</div><div class="value" style="color: #2196f3;">${(vpn * 100).toFixed(2)}%</div></div>`;
            html += '</div>';
            
            html += '<div class="formula-box" style="margin-top: 20px;">';
            html += '<h4>Interpretaci√≥n:</h4>';
            html += `<p><strong>Si la prueba da POSITIVO:</strong> La probabilidad de realmente tener la enfermedad es del <span class="highlight">${(vpp * 100).toFixed(2)}%</span></p>`;
            html += `<p><strong>Si la prueba da NEGATIVO:</strong> La probabilidad de realmente NO tener la enfermedad es del <span class="highlight">${(vpn * 100).toFixed(2)}%</span></p>`;
            html += '</div>';
            
            html += '<div class="info-box">';
            html += '<h4>üí° An√°lisis Cl√≠nico</h4>';
            if (vpp < 0.5) {
                html += '<p style="color: #e74c3c;">‚ö†Ô∏è <strong>El VPP es bajo:</strong> Un resultado positivo tiene menos del 50% de probabilidad de indicar enfermedad real. Se recomienda confirmar con una segunda prueba.</p>';
            } else if (vpp > 0.9) {
                html += '<p style="color: #27ae60;">‚úì <strong>El VPP es alto:</strong> Un resultado positivo es muy confiable. La prueba es √∫til para confirmar la presencia de enfermedad.</p>';
            } else {
                html += '<p style="color: #f39c12;">‚ö¨ <strong>El VPP es moderado:</strong> Un resultado positivo debe ser interpretado con precauci√≥n. Considere el contexto cl√≠nico.</p>';
            }
            
            if (vpn > 0.95) {
                html += '<p style="color: #27ae60;">‚úì <strong>El VPN es excelente:</strong> Un resultado negativo pr√°cticamente descarta la enfermedad. Esta prueba es muy √∫til para screening.</p>';
            }
            html += '</div>';
            
            // Tabla de confusi√≥n para 10,000 personas
            const n = 10000;
            const enfermos = Math.round(n * prevalencia);
            const sanos = n - enfermos;
            const vp = Math.round(enfermos * sensibilidad);
            const fn = enfermos - vp;
            const vn = Math.round(sanos * especificidad);
            const fp = sanos - vn;
            
            html += '<h4 style="margin-top: 20px;">Tabla de Confusi√≥n (en 10,000 personas):</h4>';
            html += '<table>';
            html += '<thead><tr><th></th><th>Enfermedad Presente</th><th>Enfermedad Ausente</th><th>Total</th></tr></thead>';
            html += '<tbody>';
            html += `<tr><td><strong>Prueba Positiva</strong></td><td style="background: #c8e6c9;">${vp}</td><td style="background: #ffccbc;">${fp}</td><td><strong>${vp + fp}</strong></td></tr>`;
            html += `<tr><td><strong>Prueba Negativa</strong></td><td style="background: #ffccbc;">${fn}</td><td style="background: #c8e6c9;">${vn}</td><td><strong>${fn + vn}</strong></td></tr>`;
            html += `<tr><td><strong>Total</strong></td><td><strong>${enfermos}</strong></td><td><strong>${sanos}</strong></td><td><strong>${n}</strong></td></tr>`;
            html += '</tbody></table>';
            
            html += '<p style="margin-top: 10px;"><small>';
            html += `<span style="color: #27ae60;">‚óè</span> VP = Verdaderos Positivos, `;
            html += `<span style="color: #2196f3;">‚óè</span> VN = Verdaderos Negativos, `;
            html += `<span style="color: #e74c3c;">‚óè</span> FP = Falsos Positivos, `;
            html += `<span style="color: #e74c3c;">‚óè</span> FN = Falsos Negativos`;
            html += '</small></p>';
            
            html += '</div>';
            
            document.getElementById('resultadosMedico').innerHTML = html;
            if (window.MathJax) MathJax.typesetPromise();
            
            // Gr√°fico
            actualizarGraficoMedico(vp, fp, vn, fn);
        }

        function actualizarGraficoMedico(vp, fp, vn, fn) {
            const ctx = document.getElementById('chartMedico');
            if (!ctx) return;
            
            if (chartMedico) {
                chartMedico.destroy();
            }
            
            chartMedico = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Verdaderos Positivos', 'Falsos Positivos', 'Verdaderos Negativos', 'Falsos Negativos'],
                    datasets: [{
                        label: 'N√∫mero de personas',
                        data: [vp, fp, vn, fn],
                        backgroundColor: ['#66bb6a', '#ef5350', '#42a5f5', '#ffa726']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Distribuci√≥n de Resultados (en 10,000 personas)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function cargarEjemploMedico(num) {
            if (num === 1) {
                // COVID-19
                document.getElementById('prevalencia').value = 5;
                document.getElementById('sensibilidad').value = 90;
                document.getElementById('especificidad').value = 95;
            } else if (num === 2) {
                // Enfermedad Rara
                document.getElementById('prevalencia').value = 0.1;
                document.getElementById('sensibilidad').value = 99;
                document.getElementById('especificidad').value = 95;
            }
        }

        // ============================================
        // TAB 4: CLASIFICADOR DE SPAM
        // ============================================
        
        function clasificarSpam() {
            const probSpam = parseFloat(document.getElementById('probSpam').value) / 100;
            
            // Probabilidades de cada palabra
            const palabras = [
                { id: 'word1', nombre: '"Gratis/Free"', pSpam: 0.80, pNoSpam: 0.10 },
                { id: 'word2', nombre: '"Dinero/Money"', pSpam: 0.70, pNoSpam: 0.05 },
                { id: 'word3', nombre: '"Urgente/Urgent"', pSpam: 0.60, pNoSpam: 0.15 },
                { id: 'word4', nombre: '"Click aqu√≠"', pSpam: 0.75, pNoSpam: 0.08 }
            ];
            
            // Determinar qu√© palabras est√°n presentes
            let palabrasPresentes = [];
            let probBayesSpam = probSpam;
            let probBayesNoSpam = 1 - probSpam;
            
            for (let palabra of palabras) {
                if (document.getElementById(palabra.id).checked) {
                    palabrasPresentes.push(palabra);
                    probBayesSpam *= palabra.pSpam;
                    probBayesNoSpam *= palabra.pNoSpam;
                }
            }
            
            if (palabrasPresentes.length === 0) {
                alert('Por favor seleccione al menos una palabra clave');
                return;
            }
            
            // Normalizar
            const total = probBayesSpam + probBayesNoSpam;
            const probSpamFinal = probBayesSpam / total;
            const probNoSpamFinal = probBayesNoSpam / total;
            
            let html = '<div class="result-box">';
            html += '<h3>Resultado de la Clasificaci√≥n</h3>';
            
            html += '<h4>Palabras detectadas:</h4>';
            html += '<ul>';
            for (let palabra of palabrasPresentes) {
                html += `<li>${palabra.nombre} - P(palabra|spam) = ${palabra.pSpam}, P(palabra|no spam) = ${palabra.pNoSpam}</li>`;
            }
            html += '</ul>';
            
            html += '<div class="stat-display" style="margin-top: 20px;">';
            html += `<div class="stat-item" style="background: ${probSpamFinal > 0.5 ? '#ffebee' : '#e8f5e9'};">`;
            html += `<div class="label">Probabilidad de SPAM</div>`;
            html += `<div class="value" style="color: ${probSpamFinal > 0.5 ? '#e74c3c' : '#666'};">${(probSpamFinal * 100).toFixed(2)}%</div>`;
            html += '</div>';
            html += `<div class="stat-item" style="background: ${probNoSpamFinal > 0.5 ? '#e8f5e9' : '#ffebee'};">`;
            html += `<div class="label">Probabilidad de NO SPAM</div>`;
            html += `<div class="value" style="color: ${probNoSpamFinal > 0.5 ? '#27ae60' : '#666'};">${(probNoSpamFinal * 100).toFixed(2)}%</div>`;
            html += '</div>';
            html += '</div>';
            
            html += '<div style="margin: 20px 0;">';
            html += '<h4>Probabilidad de SPAM:</h4>';
            html += '<div class="probability-bar">';
            html += `<div class="probability-fill" style="width: ${probSpamFinal * 100}%; background: ${probSpamFinal > 0.5 ? 'linear-gradient(90deg, #e74c3c, #c0392b)' : 'linear-gradient(90deg, #27ae60, #229954)'};">${(probSpamFinal * 100).toFixed(2)}%</div>`;
            html += '</div>';
            html += '</div>';
            
            html += `<div class="${probSpamFinal > 0.5 ? 'warning-box' : 'info-box'}">`;
            html += '<h4>ü§ñ Decisi√≥n del Filtro:</h4>';
            if (probSpamFinal > 0.7) {
                html += `<p style="color: #e74c3c;"><strong>‚ùå SPAM DETECTADO</strong> - Este email debe ser enviado a la carpeta de spam.</p>`;
            } else if (probSpamFinal > 0.3) {
                html += `<p style="color: #f39c12;"><strong>‚ö†Ô∏è SOSPECHOSO</strong> - Este email requiere revisi√≥n adicional.</p>`;
            } else {
                html += `<p style="color: #27ae60;"><strong>‚úì EMAIL LEG√çTIMO</strong> - Este email debe llegar a la bandeja de entrada.</p>`;
            }
            html += '</div>';
            
            html += '<div class="formula-box">';
            html += '<h4>C√°lculo Detallado:</h4>';
            html += `<p><strong>Paso 1:</strong> Probabilidad a priori de spam = ${(probSpam * 100).toFixed(1)}%</p>`;
            html += `<p><strong>Paso 2:</strong> Multiplicar por las verosimilitudes de cada palabra (suponiendo independencia):</p>`;
            html += '<p style="text-align: center;">$$P(palabras|spam) = ';
            for (let i = 0; i < palabrasPresentes.length; i++) {
                html += palabrasPresentes[i].pSpam;
                if (i < palabrasPresentes.length - 1) html += ' \\times ';
            }
            html += ` = ${probBayesSpam.toFixed(6)}$$</p>`;
            html += '<p style="text-align: center;">$$P(palabras|no\\ spam) = ';
            for (let i = 0; i < palabrasPresentes.length; i++) {
                html += palabrasPresentes[i].pNoSpam;
                if (i < palabrasPresentes.length - 1) html += ' \\times ';
            }
            html += ` = ${probBayesNoSpam.toFixed(6)}$$</p>`;
            html += `<p><strong>Paso 3:</strong> Normalizar para obtener la probabilidad final:</p>`;
            html += `<p style="text-align: center;">$$P(spam|palabras) = \\frac{${probBayesSpam.toFixed(6)}}{${probBayesSpam.toFixed(6)} + ${probBayesNoSpam.toFixed(6)}} = ${probSpamFinal.toFixed(6)}$$</p>`;
            html += '</div>';
            
            html += '</div>';
            
            document.getElementById('resultadosSpam').innerHTML = html;
            if (window.MathJax) MathJax.typesetPromise();
        }

        // ============================================
        // TAB 5: EJEMPLOS
        // ============================================
        
        function mostrarSolucion(num) {
            const solucionDiv = document.getElementById('solucion' + num);
            if (solucionDiv.style.display === 'none') {
                solucionDiv.style.display = 'block';
                if (window.MathJax) MathJax.typesetPromise();
            } else {
                solucionDiv.style.display = 'none';
            }
        }

        // ============================================
        // TAB 6: VISUALIZACI√ìN
        // ============================================
        
        let chartVisualizacion = null;
        let chartSensibilidad = null;

        function actualizarVisualizacion() {
            const prior = parseFloat(document.getElementById('priorSlider').value);
            const likelihood = parseFloat(document.getElementById('likelihoodSlider').value);
            const falsePos = parseFloat(document.getElementById('falseposSlider').value);
            
            document.getElementById('priorValue').textContent = prior.toFixed(2);
            document.getElementById('likelihoodValue').textContent = likelihood.toFixed(2);
            document.getElementById('falseposValue').textContent = falsePos.toFixed(2);
            
            // Calcular posterior
            const pB = likelihood * prior + falsePos * (1 - prior);
            const posterior = (likelihood * prior) / pB;
            
            // Actualizar barra de progreso
            document.getElementById('posteriorBar').style.width = (posterior * 100) + '%';
            document.getElementById('posteriorText').textContent = (posterior * 100).toFixed(2) + '%';
            document.getElementById('posteriorValue').textContent = posterior.toFixed(4);
            
            // Actualizar gr√°fico de barras
            actualizarGraficoVisualizacion(prior, likelihood, falsePos, posterior);
            
            // Actualizar gr√°fico de sensibilidad
            actualizarGraficoSensibilidad(likelihood, falsePos);
        }

        function actualizarGraficoVisualizacion(prior, likelihood, falsePos, posterior) {
            const ctx = document.getElementById('chartVisualizacion');
            if (!ctx) return;
            
            if (chartVisualizacion) {
                chartVisualizacion.destroy();
            }
            
            chartVisualizacion = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['P(A) Prior', 'P(B|A) Likelihood', 'P(B|A·∂ú) False Pos', 'P(A|B) Posterior'],
                    datasets: [{
                        label: 'Probabilidad',
                        data: [prior, likelihood, falsePos, posterior],
                        backgroundColor: ['#3498db', '#27ae60', '#e74c3c', '#f39c12']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function actualizarGraficoSensibilidad(likelihood, falsePos) {
            const ctx = document.getElementById('chartSensibilidad');
            if (!ctx) return;
            
            if (chartSensibilidad) {
                chartSensibilidad.destroy();
            }
            
            // Generar datos para diferentes valores de prior
            const priorValues = [];
            const posteriorValues = [];
            
            for (let p = 0.01; p <= 0.99; p += 0.01) {
                priorValues.push(p);
                const pB = likelihood * p + falsePos * (1 - p);
                const posterior = (likelihood * p) / pB;
                posteriorValues.push(posterior);
            }
            
            chartSensibilidad = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: priorValues.map(p => p.toFixed(2)),
                    datasets: [{
                        label: 'P(A|B) Posterior',
                        data: posteriorValues,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        },
                        title: {
                            display: true,
                            text: 'Efecto de la Probabilidad A Priori en la Probabilidad A Posteriori'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'P(A) - Probabilidad a priori'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 1,
                            title: {
                                display: true,
                                text: 'P(A|B) - Probabilidad a posteriori'
                            },
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(0) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Inicializar al cargar
        window.addEventListener('load', function() {
            actualizarVisualizacion();
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        });
    </script>
</body>
</html>

